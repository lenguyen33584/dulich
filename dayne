<?php
/**
 * Template for single hotel post type: single-khach_san.php
 */

get_header();
$post_id = get_the_ID();
$gia = get_field('gia_tour', $post_id);
$diem = get_field('diem_danh_gia', $post_id);
$so_danh_gia = get_field('so_danh_gia', $post_id);
$tien_ich = get_field('tien_ich', $post_id);
$noi_bat = get_field('noi_bat', $post_id);
$dia_chi = get_field('dia_chi_1', $post_id);
?>
<div class ="container">
<div class = "custom-container" style="max-width:1140px;margin:auto;display:flex;">
<?php if (function_exists('custom_breadcrumb')) {
    custom_breadcrumb();
}?></div>
<section class="hotel-top-header">

<div class="hotel-top-box">
    <div class="hotel-featured-gallery">
    <?php 
    $gallery = get_field('anh_dai_dien');
    if ($gallery && is_array($gallery)) : ?>
        <div class="swiper hotel-gallery-slider">
            <div class="swiper-wrapper">
                <?php foreach ($gallery as $image_url): ?>
                <div class="swiper-slide">
                    <img src="<?php echo esc_url($image_url); ?>" alt="·∫¢nh kh√°ch s·∫°n" />
                </div>
                <?php endforeach; ?>
            </div>
            <!-- N√∫t ƒëi·ªÅu h∆∞·ªõng -->
            <div class="swiper-button-next"></div>
            <div class="swiper-button-prev"></div>
        </div>
    <?php else: ?>
        <p style="color:red;">Ch∆∞a c√≥ ·∫£nh ƒë·∫°i di·ªán.</p>
    <?php endif; ?>
    </div>

  <div class="hotel-info-box">
    <h1><?php the_title(); ?></h1>
    <div style="font-size:14px;margin-bottom:0;">
      <strong style="color:green;font-size:18px;"><?php echo $diem; ?></strong>
      <span style="margin-left:8px;">Tuy·ªát v·ªùi - <?php echo $so_danh_gia; ?> ƒë√°nh gi√°</span>
    </div>
    <div style="color:#555;font-size:14px;margin:0;">
      <?php echo 'üìçüó∫Ô∏è '.$dia_chi; ?>
    </div>
    <div style="color:#e53935;font-size:20px;font-weight:bold;margin:0;">
      <?php echo number_format($gia, 0, ',', '.'); ?>ƒë
    </div>
    <?php if ($gia): ?>
      <a href="<?= site_url('/thanh-toan?price=' . intval($gia)) ?>" class="hotel-request-btn">Thanh to√°n</a>
    <?php endif; ?>
  </div>
</div>
</section>

  <!-- Tabs chuy·ªÉn m·ª•c -->
  <ul style="display:flex;list-style:none;padding:0;margin:24px 0;gap:24px;border-bottom:2px solid #eee;">
    <li><a href="#tien-ich">Ti·ªán √≠ch</a></li>
    <li><a href="#noi-bat">ƒêi·ªÉm n·ªïi b·∫≠t</a></li>
    <li><a href="#hang-phong">ƒêi·ªÉm n·ªïi b·∫≠t</a></li>
    <li><a href="#noi-dung">Gi·ªõi thi·ªáu</a></li>
  </ul>

  <!-- Ti·ªán √≠ch -->
  <div id="tien-ich">
    <h2>Ti·ªán √≠ch kh√°ch s·∫°n</h2>
    <?php if ($tien_ich): ?>
      <div style="columns:3;-webkit-columns:3;-moz-columns:3;max-height:150px;overflow:hidden;" id="list-tien-ich">
        <ul style="padding-left:20px;">
        <?php foreach ($tien_ich as $ti): ?>
          <li><?php echo esc_html($ti); ?></li>
        <?php endforeach; ?>
        </ul>
      </div>
      <button onclick="document.getElementById('list-tien-ich').style.maxHeight='none';this.style.display='none';" style="margin-top:10px;background:none;color:#e1703a;border:none;cursor:pointer;">Xem th√™m</button>
    <?php endif; ?>
  </div>

  <!-- ƒêi·ªÉm n·ªïi b·∫≠t -->
  <div id="noi-bat" style="background:#fff5e6;border-left:5px solid #ffc107;padding:16px;margin:24px 0;border-radius:8px;">
    <h2 style="color:#e1703a;margin-top:0;">ƒêi·ªÉm n·ªïi b·∫≠t <?php the_title(); ?></h2>
    <ul style="padding-left:20px;">
      <?php foreach (explode("\n", $noi_bat) as $line): ?>
        <li><?php echo esc_html($line); ?></li>
      <?php endforeach; ?>
    </ul>
  </div>

  <!-- N·ªôi dung b√†i vi·∫øt -->
<section class="hotel-rooms-section">
  <div id="hang-phong" class="hotel-rooms-container">
    <?php if( have_rows('loai_phong') ): ?>
      <?php while( have_rows('loai_phong') ): the_row(); 
        $ten_phong = get_sub_field('ten_phong');
        $anh_phong = get_sub_field('anh_phong'); // d·∫°ng m·∫£ng URL
        $dien_tich = get_sub_field('dien_tich_phong');
        $so_nguoi = get_sub_field('so_nguoi');
        $huong_phong = get_sub_field('huong_phong');
        $so_giuong = get_sub_field('so_giuong');
        $vat = get_sub_field('vat');
        $bua_an = get_sub_field('bua_an');
        $gia = get_sub_field('gia_tour');
        $ten_phong_slug = 'phong-' . sanitize_title($ten_phong);
      ?>
      <div class="room-card">
        <div class="room-image">
          <?php if ($anh_phong && is_array($anh_phong)): ?>
            <img src="<?php echo esc_url($anh_phong[0]); ?>" alt="<?php echo esc_attr($ten_phong); ?>">
          <?php endif; ?>
        </div>

        <div class="room-info">
          <h3><?php echo esc_html($ten_phong); ?></h3>

          <?php if (!empty($anh_phong)): ?>
            <div class="room-detail-link">
                <a href="javascript:void(0);" class="open-fancybox" data-gallery="<?php echo esc_attr($ten_phong_slug); ?>">
                    Chi ti·∫øt ph√≤ng &nbsp;‚Ä∫
                </a>

                <?php foreach ($anh_phong as $anh): ?>
                    <a href="<?php echo esc_url($anh); ?>"
                    data-fancybox="<?php echo esc_attr($ten_phong_slug); ?>"
                    style="display:none;">
                    </a>
                <?php endforeach; ?>
            </div>
            <?php endif; ?>

          <div class="room-info-grid">
            <div><strong>Di·ªán t√≠ch:</strong> <?php echo esc_html($dien_tich); ?>m¬≤</div>
            <div><strong>S·ª©c ch·ª©a:</strong> <?php echo esc_html($so_nguoi); ?></div>
            <div><strong>H∆∞·ªõng:</strong> <?php echo esc_html($huong_phong); ?></div>
            <div><strong>Gi∆∞·ªùng:</strong> <?php echo esc_html($so_giuong); ?></div>
          </div>

          <div class="room-sub-info">
            <div><strong>‚úîÔ∏è ƒê√É </strong>bao g·ªìm thu·∫ø VAT v√† ph√≠ d·ªãch v·ª•.</div>
            <div><strong>‚úîÔ∏è ƒê√É </strong>bao g·ªìm ƒÉn s√°ng.</div>
          </div>

          <a href="/thanh-toan?price=<?php echo $gia; ?>" class="room-price-box">
            <?php echo number_format($gia, 0, ',', '.'); ?>ƒë
          </a>
          <a href="/thanh-toan?price=<?php echo $gia; ?>" class="room-price-box">Thanh to√°n ngay</a>
        </div>
      </div>
      <?php endwhile; ?>
    <?php endif; ?>
  </div>
  <div class="hotel-default-policy">

  <h3><strong>Quy ƒë·ªãnh nh·∫≠n & tr·∫£ ph√≤ng</strong></h3>
  <p><strong>Th·ªùi gian nh·∫≠n ph√≤ng:</strong> 14:00</p>
  <p><strong>Th·ªùi gian tr·∫£ ph√≤ng:</strong> 12:00</p>

  <hr>

  <p><strong>Quy ƒë·ªãnh nh·∫≠n ph√≤ng:</strong></p>
  <ul>
    <li>CCCD ho·∫∑c passport.</li>
    <li>Phi·∫øu x√°c nh·∫≠n ƒë·∫∑t ph√≤ng c·ªßa h·ªá th·ªëng.</li>
  </ul>
  <p style="color: red;"><strong>*L∆∞u √Ω:</strong><br>
    Theo quy ƒë·ªãnh c·ªßa ph√°p lu·∫≠t Vi·ªát Nam, khi 1 kh√°ch n∆∞·ªõc ngo√†i + 1 kh√°ch Vi·ªát Nam ·ªü chung ph√≤ng th√¨ y√™u c·∫ßu ph·∫£i c√≥ gi·∫•y ƒëƒÉng k√Ω k·∫øt h√¥n.
  </p>

  <hr>

  <h3><strong>Quy ƒë·ªãnh h·ªßy/ƒë·ªïi ƒë·∫∑t ph√≤ng</strong></h3>
  <ul>
    <li>Ph√≠ h·ªßy/ƒë·ªïi = ph√≠ h·ªßy c·ªßa kh√°ch s·∫°n + ph√≠ x·ª≠ l√Ω giao d·ªãch.</li>
    <li><strong>Ph√≠ h·ªßy/ƒë·ªïi c·ªßa kh√°ch s·∫°n ƒë∆∞·ª£c quy ƒë·ªãnh nh∆∞ sau:</strong></li>
    <ul>
      <li>Kh√¥ng ho√†n ph√≤ng, nh∆∞ng ƒë∆∞·ª£c ph√©p ƒë·ªïi ƒë∆°n ƒë·∫∑t ph√≤ng.</li>
    </ul>
    <li><strong>Ph√≠ x·ª≠ l√Ω giao d·ªãch:</strong></li>
    <ul>
      <li>D∆∞·ªõi 3 tri·ªáu: 2% t·ªïng gi√° tr·ªã (t·ªëi thi·ªÉu 30.000ƒë)</li>
      <li>Tr√™n 3 tri·ªáu: 1.5% t·ªïng gi√° tr·ªã</li>
    </ul>
  </ul>

  <hr>

  <h3><strong>Tr·∫ª em v√† gi∆∞·ªùng ph·ª•</strong></h3>
  <ul>
    <li><strong>Em b√© (d∆∞·ªõi 5 tu·ªïi):</strong> Mi·ªÖn ph√≠ n·∫øu ng·ªß c√πng b·ªë m·∫π.</li>
    <li><strong>Tr·∫ª em (5‚Äì10 tu·ªïi):</strong> Thu theo quy ƒë·ªãnh kh√°ch s·∫°n.</li>
  </ul>

</div>
</section>


<!-- Fancybox CSS & JS -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui@5.0/dist/fancybox/fancybox.css" />
<script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui@5.0/dist/fancybox/fancybox.umd.js"></script>
<!-- Swiper CSS -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css" />

<!-- Swiper JS -->
<script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script>
<script>
document.addEventListener("DOMContentLoaded", function () {
  new Swiper('.hotel-gallery-slider', {
    loop: true,
    navigation: {
      nextEl: '.swiper-button-next',
      prevEl: '.swiper-button-prev',
    },
    slidesPerView: 1,
    spaceBetween: 10,
  });
});
</script>
<script>
document.addEventListener("DOMContentLoaded", function () {
  const buttons = document.querySelectorAll(".open-fancybox");

  buttons.forEach(function (btn) {
    btn.addEventListener("click", function (e) {
      e.preventDefault();
      const galleryName = btn.getAttribute("data-gallery");
      const group = document.querySelectorAll('[data-fancybox="' + galleryName + '"]');

      if (group.length > 0 && typeof Fancybox !== 'undefined') {
        Fancybox.show(
          Array.from(group).map(link => ({
            src: link.getAttribute("href"),
            type: "image"
          })),
          {
            groupAll: true
          }
        );
      }
    });
  });
});
</script>

<style>
.hotel-default-policy {
  font-size: 15px;
  line-height: 1.7;
  margin-top: 40px;
}

.hotel-default-policy hr {
  border: none;
  border-top: 1px dashed #ccc;
  margin: 25px 0;
}

.hotel-default-policy h3 {
  font-size: 17px;
  margin-top: 20px;
}

.hotel-default-policy ul {
  margin-left: 20px;
  padding-left: 0;
}
.hotel-featured-gallery {
  width: 100%;
  overflow: hidden;
}

.hotel-gallery-slider {
  width: 100%;
  height: auto;
  position: relative;
}
.hotel-gallery-slider .swiper-slide img {
  width: 100%;
  height: auto;
  object-fit: cover;
}
.hotel-info-box {
  padding: 10px;
  background: #fff;
  border-radius: 10px;
}
.container {
  max-width: 1140px;
  margin-left: auto;
  margin-right: auto;
  padding-left: 16px;
  padding-right: 16px;
  width: 100%;
}
.hotel-request-btn {
  display: inline-block;
  padding: 10px 18px;
  border-radius: 6px;
  text-decoration: none;
  font-weight: bold;
  margin-top: 10px;
  transition: all 0.3s ease;
  border: 2px solid #660000;
  background: #660000;
  color: #fff;
  text-align: center;
}

.hotel-request-btn:hover {
  background: #990000;
  border-color: #990000;
}
.hotel-top-header {
  background: #fff;
  border-radius: 12px;

}

.hotel-top-grid {
  display: flex;
  flex-wrap: wrap;
  gap: 24px;
}

.hotel-featured-img {
  flex: 0 0 55%;
  max-width: 55%;
  
}

.hotel-featured-img img {
  width: 100%;
  border-radius: 10px;
  object-fit: cover;
}

.hotel-info-box {
  flex: 0 0 40%;
  max-width: 40%;
  display: flex;
  flex-direction: column;
  gap: 10px;
}

@media (max-width: 768px) {
  .hotel-top-grid {
    flex-direction: column;
  }

  .hotel-featured-img,
  .hotel-info-box {
    max-width: 100%;
    width: 100%;
    flex: 0 0 100%;
  }

  .hotel-featured-img img {
    width: 100%;
    height: auto;
    border-radius: 10px;
  }
}

.hotel-rooms-section {
  padding: 30px 15px;
  background-color: #f9f9f9;
}
.hotel-rooms-container {
  max-width: 1100px;
  margin: auto;
}
.room-card {
  display: flex;
  gap: 20px;
  margin-bottom: 30px;
  background: #fff;
  border: 1px solid #eee;
  border-radius: 8px;
  overflow: hidden;
  padding: 15px;
  align-items: center;
}
.room-image {
  flex-shrink: 0;
  display: flex;
  justify-content: center;
  align-items: center;
}
.room-image img {
  width: 200px;
  height: auto;
  object-fit: cover;
  border-radius: 6px;
}
.room-info {
  flex: 1;
}
.room-info h3 {
  margin: 0 0 12px;
  color: #222;
  font-size: 20px;
}
.room-info-grid {
  display: grid;
  grid-template-columns: repeat(2, 1fr);
  gap: 5px 20px;
  margin-bottom: 10px;
  font-size: 14px;
}
.room-sub-info {
  font-size: 14px;
  margin-bottom: 12px;
}
.room-sub-info div {
  margin-bottom: 4px;
}
.room-price-box {
  display: inline-block;
  border: 2px solid #660000;
  color: #660000;
  font-weight: bold;
  font-size: 18px;
  padding: 6px 14px;
  border-radius: 5px;
  text-align: center;
}

/* Responsive mobile */
@media (max-width: 768px) {
  .room-card {
    flex-direction: column;
    text-align: center;
  }
  .room-image img {
    width: 100%;
    max-width: 100%;
  }
  .room-info-grid {
    grid-template-columns: 1fr 1fr;
    text-align: left;
    justify-content: center;
  }
  .room-sub-info {
    text-align: left;
  }
  .room-price-box {
    margin-top: 10px;
  }
}
</style> 

<div id = "danh-gia" style="margin-top: 40px;">
      <h2>ƒê√°nh gi√° c·ªßa Kh√°ch h√†ng</h2>
      <div style="font-size: 18px; font-weight: bold; color: green;">9.2 <span style="color:#444; font-size:14px;">Tuy·ªát v·ªùi - 62 ƒë√°nh gi√°</span></div>
      <div style="margin: 12px 0 20px;"><a href="#" style="color:#e1703a;">ƒêi·ªÉm chi ti·∫øt &raquo;</a></div>

      <?php
      $danh_gia = [
        ['name' => 'Kh√°nh An', 'score' => '9.4', 'content' => 'D·ªãch v·ª• ·ªü ƒë√¢y r·∫•t t·ªët, nh√¢n vi√™n th√¢n thi·ªán, kh√¥ng gian s·∫°ch s·∫Ω. M√¨nh ·∫•n t∆∞·ª£ng nh·∫•t l√† buffet s√°ng.'],
        ['name' => 'VƒÉn Khoa', 'score' => '9.4', 'content' => 'H·ªì b∆°i ƒë·∫πp v√† r·ªông. Ph√≤ng ·ªëc hi·ªán ƒë·∫°i. M√¨nh s·∫Ω quay l·∫°i l·∫ßn sau.'],
        ['name' => 'ƒê·ª©c ƒê·∫°t', 'score' => '9.2', 'content' => 'Gia ƒë√¨nh m√¨nh ƒë√£ c√≥ k·ª≥ ngh·ªâ tuy·ªát v·ªùi. Tr·∫ª em r·∫•t th√≠ch khu vui ch∆°i ·ªü ƒë√¢y.'],
        ['name' => 'Th·∫£o Lan', 'score' => '9.2', 'content' => 'Nh√¢n vi√™n h·ªó tr·ª£ nhi·ªát t√¨nh, b·ªØa ƒÉn ngon. V·ªã tr√≠ g·∫ßn trung t√¢m n√™n r·∫•t ti·ªán ƒëi l·∫°i.'],
        ['name' => 'Minh Huy', 'score' => '9.3', 'content' => 'C·∫£nh quan ƒë·∫πp, ph√≤ng r·ªông r√£i, view nh√¨n ra bi·ªÉn c·ª±c k·ª≥ chill.'],
        ['name' => 'Ng·ªçc H√†', 'score' => '9.5', 'content' => 'ƒêi ngh·ªâ d∆∞·ª°ng c√πng b·∫°n b√® r·∫•t vui. ƒê·∫∑c bi·ªát th√≠ch kh√¥ng gian nh√† h√†ng v√† spa.'],
        ['name' => 'L√™ D∆∞∆°ng', 'score' => '9.1', 'content' => 'D·ªãch v·ª• chuy√™n nghi·ªáp, m√¨nh ƒë√°nh gi√° cao s·ª± chu ƒë√°o c·ªßa nh√¢n vi√™n.'],
        ['name' => 'Ho√†ng T√∫', 'score' => '9.3', 'content' => 'B·ªØa s√°ng ƒëa d·∫°ng m√≥n, ph√≤ng ƒë∆∞·ª£c d·ªçn s·∫°ch m·ªói ng√†y.'],
        ['name' => 'Qu·ª≥nh Mai', 'score' => '9.0', 'content' => 'V·ªã tr√≠ ti·ªán l·ª£i, g·∫ßn c√°c ƒëi·ªÉm tham quan. Gi√° c·∫£ h·ª£p l√Ω.'],
        ['name' => 'Anh Khoa', 'score' => '9.2', 'content' => 'Ch·∫•t l∆∞·ª£ng t·ªët so v·ªõi t·∫ßm gi√°. R·∫•t ƒë√°ng ƒë·ªÉ tr·∫£i nghi·ªám.'],
      ];

      foreach ($danh_gia as $dg) {
        echo '<div style="border-top:1px solid #eee;padding:16px 0;">';
        echo '<div style="font-weight:bold;color:green;font-size:16px;">' . esc_html($dg['score']) . ' <span style="color:#555;">Tuy·ªát v·ªùi</span> - ' . esc_html($dg['name']) . '</div>';
        echo '<p style="margin: 8px 0;">' . esc_html($dg['content']) . '</p>';
        echo '</div>';
      }
      ?>
    </div>
<?php while (have_posts()) : the_post(); ?>
  <?php
    $content = apply_filters('the_content', get_the_content());
    preg_match_all('/<h([2-4])[^>]*>(.*?)<\/h[2-4]>/', $content, $matches, PREG_SET_ORDER);

    foreach ($matches as $index => $heading) {
      $level = $heading[1];
      $title = strip_tags($heading[2]);
      $slug = 'toc-' . $index;
      $content = preg_replace(
        '/' . preg_quote($heading[0], '/') . '/',
        '<h' . $level . ' id="' . $slug . '">' . $heading[2] . '</h' . $level . '>',
        $content,
        1
      );
      $toc_items[] = [
        'slug' => $slug,
        'title' => $title,
        'level' => $level
      ];
    }
  ?>
  <section class="hotel-article-section">
    <div class="container">
      <div class="hotel-article-wrapper">
        <aside class="hotel-article-sidebar">
          <div class="hotel-toc">
            <h3>Th√¥ng tin chi ti·∫øt</h3>
            <ul>
              <?php foreach ($toc_items as $item): ?>
                <li class="toc-level-<?php echo $item['level']; ?>">
                  <a href="#<?php echo esc_attr($item['slug']); ?>"><?php echo esc_html($item['title']); ?></a>
                </li>
              <?php endforeach; ?>
            </ul>
          </div>
        </aside>
        <article class="hotel-article-content">
          <?php echo $content; ?>
        </article>
      </div>
    </div>

  <style>
    .hotel-article-section {
    margin-top: 40px;
    padding: 30px 0;
    background-color: #fff;
    }

    .hotel-article-wrapper {
    display: flex;
    gap: 30px;
    align-items: flex-start;
    }

    .hotel-article-sidebar {
    width: 25%;
    border-right: 1px solid #eee;
    padding-right: 20px;
    font-size: 15px;
    position: sticky;
    top: 100px;
    max-height: 80vh;
    overflow-y: auto;
    }

    .hotel-toc h3 {
    font-weight: bold;
    margin-bottom: 15px;
    }

    .hotel-toc ul {
    list-style: none;
    padding: 0;
    margin: 0;
    }

    .hotel-toc li {
    margin-bottom: 8px;
    }

    .toc-level-2 a {
    font-weight: 600;
    color: #000;
    }

    .toc-level-3 a,
    .toc-level-4 a {
    padding-left: 10px;
    color: #666;
    font-size: 14px;
    }

    .hotel-article-content {
    width: 75%;
    font-size: 16px;
    line-height: 1.8;
    }
  </style>
  </section>
<?php endwhile; ?>
</div>

<?php get_footer(); ?>
