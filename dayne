<div style="max-width:1140px;margin:auto;display:flex;gap:24px;margin-top:32px">
<?php if (function_exists('custom_breadcrumb')) {
    custom_breadcrumb();
}?>
<aside style="width:250px;background:#f9f9f9;padding:16px;border-radius:8px;border:1px solid #eee">
<h3 style="margin-top:0">Bộ lọc</h3>
<form id="filter-form" method="get">
<input type="hidden" name="type" value="<?= esc_attr($type) ?>">
<?php if ($khoihanh_list): ?>
<p><strong>Khởi hành:</strong></p>
<?php foreach ($khoihanh_list as $val): ?>
<label><input type="checkbox" name="khoihanh[]" value="<?= esc_attr($val) ?>" <?= in_array($val, $filters['khoihanh']) ? 'checked' : '' ?>> <?= esc_html($val) ?></label><br>
<?php endforeach; endif; ?>
<?php if ($thoi_gian_list): ?>
<p><strong>Thời gian:</strong></p>
<?php foreach ($thoi_gian_list as $val): ?>
<label><input type="checkbox" name="thoi_gian[]" value="<?= esc_attr($val) ?>" <?= in_array($val, $filters['thoi_gian']) ? 'checked' : '' ?>> <?= esc_html($val) ?></label><br>
<?php endforeach; endif; ?>
<p><strong>Mức giá trong khoảng:</strong></p>
<?php
$gia_labels = [
  '1000000-5000000' => 'Từ 1 triệu đến 5 triệu',
  '5000000-10000000' => 'Từ 5 triệu đến 10 triệu',
  '10000000-20000000' => 'Từ 10 triệu đến 20 triệu',
  '20000000-30000000' => 'Từ 20 triệu đến 30 triệu',
  '30000000-900000000' => 'Trên 30 triệu'
];
foreach ($gia_labels as $val => $label):
  if (in_array($val, $gia_ranges)):
?>
<label><input type="checkbox" name="gia_khoang[]" value="<?= $val ?>" <?= in_array($val, $filters['gia_khoang']) ? 'checked' : '' ?>> <?= $label ?></label><br>
<?php endif; endforeach; ?>
<?php if ($diem_den_list): ?>
<p><strong>Điểm đến:</strong></p>
<?php foreach ($diem_den_list as $val): ?>
<label><input type="checkbox" name="diemden[]" value="<?= esc_attr($val) ?>" <?= in_array($val, $filters['diemden']) ? 'checked' : '' ?>> <?= esc_html($val) ?></label><br>
<?php endforeach; endif; ?>
</form>
</aside>

<main style="flex:1">
<h2>Kết quả <?= ($type === 'tour' ? 'tour' : 'khách sạn') ?> ở <?= esc_html($term->name) ?></h2>
<?php if ($query->have_posts()): ?>
<div style="display:flex;flex-direction:column;gap:24px">
<?php while ($query->have_posts()): $query->the_post(); ?>
<div style="border:1px solid #eee;padding:16px;border-radius:8px;display:flex;gap:16px">
<div style="flex:0 0 200px">
<?php the_post_thumbnail('medium', ['style'=>'border-radius:8px']) ?>
</div>
<div style="flex:1">
<h3 style="margin:0"><a href="<?php the_permalink(); ?>" style="color:#333;text-decoration:none"><?php the_title(); ?></a></h3>
<p><strong>Khởi hành:</strong> <?php the_field('khoihanh'); ?> | <strong>Thời gian:</strong> <?php the_field('thoi_gian'); ?></p>
<p><strong>Giá:</strong> <?= number_format(get_field($type === 'tour' ? 'gia_tour' : 'gia'), 0, ',', '.') ?> đ</p>
<a href="<?php the_permalink(); ?>" style="color:#e1703a;font-weight:bold">Xem chi tiết &raquo;</a>
</div></div>
<?php endwhile; ?>
</div>
<div style="margin-top:24px">
<?= paginate_links(['total' => $query->max_num_pages]) ?>
</div>
<?php else: ?><p>Không tìm thấy kết quả phù hợp.</p><?php endif; ?>
<?php wp_reset_postdata(); ?>
</main>
</div>
